
# دليل النسخ الاحتياطي واستعادة البيانات (Backup & Recovery)

يوضح هذا الدليل كيفية حماية بيانات النظام المالية وضمان استمراريتها.

### 1. النسخ الاحتياطي لقاعدة البيانات (Database)
- **Supabase Automatic Backups**: يتم تفعيل النسخ التلقائي يومياً في المشاريع المدفوعة (Pro).
- **Manual Export (pg_dump)**: يوصى بتصدير البيانات يدوياً قبل أي تحديثات هيكلية كبيرة:
  ```bash
  # تصدير البيانات باستخدام Supabase CLI
  supabase db dump --data-only > backups/data_$(date +%F).sql
  ```

### 2. النسخ الاحتياطي للمرفقات (Storage)
- يتم تخزين المرفقات في S3 Buckets محمية.
- لاستعادة المرفقات في حال فقدان الوصول، يجب استخدام أداة `rclone` لمزامنة الـ Bucket مع تخزين خارجي دورياً.

### 3. إجراءات الاستعادة (Recovery Procedure)
في حال حدوث خطأ كارثي (مثلاً حذف شركة بالخطأ):
1. إيقاف حركة المرور على الواجهة الأمامية.
2. استعادة نسخة SQL الأخيرة إلى قاعدة بيانات تجريبية (Staging).
3. استخدام `INSERT INTO ... SELECT` لاستعادة السجلات المفقودة فقط لضمان عدم تعارض الـ IDs.
4. إعادة ربط المرفقات بالتحقق من مسارات الـ Storage.

**ملاحظة:** سجل التدقيق (Audit Logs) هو مرجعك الأول لإعادة بناء أي حركات مالية مفقودة يدوياً.
